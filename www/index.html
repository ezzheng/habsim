<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=yes" />
    <title>HABSIM: High Altitude Balloon Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script>
    const dev = false; //
    const URL_ROOT = "https://habsim-xd47.onrender.com/sim"
    </script>
    <style type="text/css">
        :root{
            --bg:#ffffff; --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --soft:#f3f4f6; --soft2:#fafafa; --brand:#111827; --brand-600:#0b1220;
            --radius:8px; --space:12px; --space-sm:8px; --space-xs:4px;
        }
        @media (prefers-color-scheme: dark){
            :root{ --bg:#0b0f14; --fg:#e5e7eb; --muted:#9ca3af; --line:#1f2937; --soft:#0f1520; --soft2:#0d131d; --brand:#93c5fd; --brand-600:#60a5fa; }
        }
        html, body { height: 100%; margin: 0; padding: 0; }
        body {
            display: flex;
            flex-direction: column;
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            color: var(--fg);
            background: var(--bg);
        }
        main {
            flex: 1;
            display: flex;
        }
        #map{ flex: 1; height: 100%; width: 100%; margin: 0; padding: 0}
        /* Top bar */
        #info {
            width: 100%;
            top: 0px;
            background-color: var(--bg);
            color: var(--fg);
            border-bottom: 1px solid var(--line);
            box-shadow: 0 1px 0 rgba(0,0,0,0.03);
        }
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space);
            padding: 4px 12px;
            flex-wrap: wrap;
        }
        .topbar-group {
            display: flex;
            align-items: center;
            gap: var(--space);
            flex-wrap: wrap;
        }
        .topbar-group-left { flex: 1 1 420px; }
        .topbar-group-right {
            flex: 1 1 320px;
            justify-content: flex-end;
            text-align: right;
        }
        .topbar-group-right,
        .topbar-buttons { display: flex; align-items: center; gap: var(--space-sm); flex-wrap: wrap; }
        .topbar-buttons { justify-content: flex-end; }
        .brand {
            font-weight: 600;
            letter-spacing: 0.2px;
            color: var(--fg);
            font-size: 15px;
        }
        .toggle-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            margin: 0;
        }
        .toggle-label .toggle { margin: 0; }
        .segmented {
            display: inline-flex;
            border: 1px solid var(--line);
            border-radius: var(--radius);
            overflow: hidden;
            background: var(--bg);
        }
        .segment {
            padding: 4px 9px;
            background: var(--bg);
            cursor: pointer;
            border: none;
            font-weight: 500;
            color: var(--fg);
            font-size: 12.5px;
        }
        .segment:hover{ background: var(--soft2); }
        .segment.active { background: var(--brand); color: #ffffff; }
        .divider { width: 1px; background: var(--line); }
        .status { font-size: 12px; color: var(--muted); white-space: nowrap; }
        .btn-primary-modern {
            background: var(--brand);
            color: #fff;
            border: 1px solid var(--brand);
            padding: 6px 12px;
            border-radius: var(--radius);
            transition: background .15s ease,border-color .15s ease,box-shadow .15s ease;
            font-size: 12.5px;
        }
        .btn-primary-modern:hover{ background: var(--brand-600); border-color: var(--brand-600); }
        .btn-ghost {
            background: transparent;
            border: 1px solid var(--line);
            color: var(--fg);
            padding: 5px 10px;
            border-radius: var(--radius);
            transition: background .15s ease,border-color .15s ease;
            font-size: 12.5px;
        }
        .btn-ghost:hover{ background: var(--soft2); }
        .toggle {
            border: solid 1px #a2a2a2;
        }
        /* Parameter panel */
        #param-panel {
            border-top: 1px solid var(--soft);
            padding: 6px 12px 8px 12px;
            background: var(--soft2);
            max-height: 60vh;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch;
        }
        .param-grid {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }
        .param-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: var(--space-sm);
            align-items: center;
        }
        .param-field {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
            font-size: 13px;
            color: var(--fg);
        }
        .param-field .field-label {
            flex: 0 0 130px;
            font-weight: 600;
            white-space: nowrap;
        }
        .field-label-empty { visibility: hidden; }
        .param-field .field-inputs {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            flex: 1 1 auto;
            min-width: 0;
        }
        .param-field-button .field-inputs { flex: 0 0 auto; }
        .param-field-button .btn-ghost { min-width: 180px; }
        .param-field-status {
            font-weight: 600;
            gap: 6px;
        }
        .param-field-status .field-label { flex: 0 0 auto; }
        .param-field-status span:last-child { font-weight: 600; }
        .field-input {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 5px 8px;
            background: var(--bg);
            color: var(--fg);
        }
        .field-input:focus { outline: 2px solid var(--brand-600); outline-offset: 1px; }
        .field-sep {
            color: var(--muted);
            font-weight: 500;
        }
        .unit {
            font-size: 12px;
            color: var(--muted);
            white-space: nowrap;
        }
        .field-input-xs { width: 48px; }
        .field-input-sm { width: 64px; }
        .field-input-md { width: 88px; }
        .field-input-lg { width: 120px; }
        .help { font-size: 11px; color: var(--muted); margin: 4px 0 0 0; }
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }
        @media (max-width: 900px) {
            .topbar { flex-direction: column; align-items: stretch; gap: var(--space-sm); }
            .topbar-group { justify-content: space-between; }
            .topbar-group-right { text-align: left; justify-content: space-between; }
            .topbar-buttons { justify-content: flex-start; width: 100%; }
            .status { white-space: normal; }
        }
        @media (max-width: 768px) {
            .topbar-group { gap: var(--space-sm); }
            .param-row { grid-template-columns: 1fr; }
            .param-field {
                flex-wrap: wrap;
                gap: 6px;
            }
            .param-field .field-label { flex: 1 1 100px; }
            .param-field .field-inputs { flex: 1 1 100%; }
            .param-field-button .btn-ghost { width: 100%; }
            .topbar-buttons { flex-direction: column; align-items: stretch; gap: var(--space-xs); }
            .btn-primary-modern, .btn-ghost { width: 100%; display: inline-flex; justify-content: center; }
        }
    </style>
</head>
<body>
<nav id="info" class="navbar navbar-light bg-light" style="position:fixed; top:0; left:0; right:0; z-index:1000;">
    <div class="topbar">
        <div class="topbar-group topbar-group-left">
            <div class="brand">HABSIM</div>
            <div class="segmented" role="group" aria-label="Mode">
                <button class="segment active" data-mode="standardbln">Standard</button>
                <div class="divider"></div>
                <button class="segment" data-mode="zpbbln">ZPB</button>
                <div class="divider"></div>
                <button class="segment" data-mode="floatbln">Float</button>
            </div>
            <label class="toggle-label" for="toggle-event">
                <span>Waypoints</span>
                <input id="toggle-event" type="checkbox" checked data-toggle="toggle" data-on="Enabled" data-off="Disabled" data-size="small" data-onstyle="success">
            </label>
            <button id="collapse-toggle" class="btn-ghost" title="Show/Hide parameters">Toggle panel</button>
        </div>
        <div class="topbar-group topbar-group-right">
            <div class="status" role="status">Model run: <span id="run">Unavailable</span> • Server: <span id="status">Unavailable</span></div>
            <div class="topbar-buttons">
                <button class="btn-primary-modern" type="button" onclick="simulate()">Simulate</button>
                <button id="eqtimebtn" class="btn-ghost" type="button" onclick="getTimeremain()">Remaining Time</button>
            </div>
        </div>
    </div>
    <div id="param-panel">
        <div class="param-grid">
            <div class="param-row">
                <div class="param-field param-field-date">
                    <span class="field-label">Date</span>
                    <div class="field-inputs">
                        <input id="mo" class="field-input field-input-xs" type="text" name="mo">
                        <span class="field-sep">/</span>
                        <input id="day" class="field-input field-input-xs" type="text" name="day">
                        <span class="field-sep">/</span>
                        <input id="yr" class="field-input field-input-lg" type="text" name="yr">
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Lat</span>
                    <div class="field-inputs">
                        <input id="lat" class="field-input field-input-md" type="text" name="lat">
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Launch altitude</span>
                    <div class="field-inputs">
                        <input id="alt" class="field-input field-input-md" type="text" name="alt">
                        <span class="unit">m</span>
                    </div>
                </div>
            </div>
            <div class="param-row">
                <div class="param-field param-field-time">
                    <span class="field-label">Time (UTC)</span>
                    <div class="field-inputs">
                        <input id="hr" class="field-input field-input-xs" type="text" name="hr">
                        <span class="field-sep">:</span>
                        <input id="mn" class="field-input field-input-xs" type="text" name="mn">
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Lon</span>
                    <div class="field-inputs">
                        <input id="lon" class="field-input field-input-md" type="text" name="lon">
                    </div>
                </div>
                <div class="param-field param-field-button">
                    <span class="field-label field-label-empty" aria-hidden="true">Get ground elevation</span>
                    <div class="field-inputs">
                        <button class="btn-ghost" onclick="getElev()">Get ground elevation</button>
                    </div>
                </div>
            </div>
            <div class="param-row">
                <div class="param-field">
                    <span class="field-label">Ascent rate</span>
                    <div class="field-inputs">
                        <input id="asc" class="field-input field-input-md" type="text" name="asc">
                        <span class="unit">m/s</span>
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Burst/Equilibrium altitude</span>
                    <div class="field-inputs">
                        <input id="equil" class="field-input field-input-md" type="text" name="equil">
                        <span class="unit">m</span>
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Descent rate</span>
                    <div class="field-inputs">
                        <input id="desc" class="field-input field-input-md" type="text" name="desc">
                        <span class="unit">m/s</span>
                    </div>
                </div>
            </div>
            <div class="param-row extra-row">
                <div class="param-field" id="group-eqtime" style="display:none;">
                    <span class="field-label">Time at Equilibrium</span>
                    <div class="field-inputs">
                        <input id="eqtime" class="field-input field-input-md" type="text" name="eqtime">
                        <span class="unit">h</span>
                    </div>
                </div>
                <div class="param-field" id="group-coeff" style="display:none;">
                    <span class="field-label">Floating Coefficient</span>
                    <div class="field-inputs">
                        <input id="coeff" class="field-input field-input-md" type="text" name="coeff">
                    </div>
                </div>
                <div class="param-field" id="group-dur" style="display:none;">
                    <span class="field-label">Simulate for</span>
                    <div class="field-inputs">
                        <input id="dur" class="field-input field-input-md" type="text" name="dur">
                        <span class="unit">h</span>
                    </div>
                </div>
                <div class="param-field" id="group-step" style="display:none;">
                    <span class="field-label">Step Size</span>
                    <div class="field-inputs">
                        <input id="step" class="field-input field-input-md" type="text" name="step">
                        <span class="unit">s</span>
                    </div>
                </div>
                <div class="param-field param-field-status" id="group-timeremain">
                    <span class="field-label">Remaining</span>
                    <div class="field-inputs">
                        <span id="timeremain"></span>
                    </div>
                </div>
            </div>
            <p class="help">Click on map to get coordinates</p>
        </div>
        <div class="visually-hidden" aria-hidden="true">
            <input type="radio" name="optradio" class="radiobtn" value="standardbln" checked>
            <input type="radio" name="optradio" class="radiobtn" value="zpbbln">
            <input type="radio" name="optradio" class="radiobtn" value="floatbln">
        </div>
    </div>
</nav>
<main id="main-container">
    <div id="map"></div>
</main>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC62-iKLT_54_N0cPnbQlrzIsEKQxiAJgA&v=quarterly"></script>
<script type="text/javascript" src = "style.js"></script>
<script type="text/javascript" src = "paths.js"></script>
<script type="text/javascript" src = "util.js"></script>
<script>
    function adjustLayout() {
        const nav = document.getElementById('info');
        const main = document.getElementById('main-container');
        if (!nav || !main) return;
        const navHeight = nav.offsetHeight;
        document.body.style.paddingTop = navHeight + 'px';
        main.style.height = `calc(100vh - ${navHeight}px)`;
    }
    window.addEventListener('load', adjustLayout);
    window.addEventListener('resize', adjustLayout);
        // topbar segmented buttons
        window.addEventListener('DOMContentLoaded', function(){
            const segs = document.querySelectorAll('.segment');
            segs.forEach(btn => {
                btn.addEventListener('click', () => {
                    segs.forEach(b=>b.classList.remove('active'));
                    btn.classList.add('active');
                    const val = btn.getAttribute('data-mode');
                    const radio = document.querySelector(`input[name="optradio"][value="${val}"]`);
                    if (radio) { radio.checked = true; radio.dispatchEvent(new Event('change')); }
                });
            });
            const collapseBtn = document.getElementById('collapse-toggle');
            const panel = document.getElementById('param-panel');
            collapseBtn.addEventListener('click', () => {
                if (panel.style.display === 'none') panel.style.display = '';
                else panel.style.display = 'none';
                adjustLayout();
            });
        });
</script>
</body>
</html>
