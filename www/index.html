<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=yes" />
    <title>HABSIM: High Altitude Balloon Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script>
    const dev = false; //
    const URL_ROOT = "https://habsim-xd47.onrender.com/sim"
    </script>
    <style type="text/css">
        :root{
            --bg:#ffffff; --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --soft:#f3f4f6; --soft2:#fafafa; --brand:#111827; --brand-600:#0b1220;
            --radius:8px; --space:12px; --space-sm:8px; --space-xs:4px;
        }
        @media (prefers-color-scheme: dark){
            :root{ --bg:#0b0f14; --fg:#e5e7eb; --muted:#9ca3af; --line:#1f2937; --soft:#0f1520; --soft2:#0d131d; --brand:#93c5fd; --brand-600:#60a5fa; }
        }
        html, body { height: 100%; margin: 0; padding: 0; }
        body {
            display: flex;
            flex-direction: column;
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            color: var(--fg);
            background: var(--bg);
        }
        main {
            flex: 1;
            display: flex;
        }
        #map{ flex: 1; height: 100%; width: 100%; margin: 0; padding: 0}
        /* Top bar */
        #info {
            width: 100%;
            top: 0px;
            background-color: var(--bg);
            color: var(--fg);
            border-bottom: 1px solid var(--line);
            box-shadow: 0 1px 0 rgba(0,0,0,0.03);
        }
        .topbar {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
            padding: 4px 24px 0 24px;
        }
        .topbar-firstline {
            display: flex;
            align-items: center;
            gap: var(--space);
            flex-wrap: wrap;
        }
        .topbar-firstline .topbar-spacer { flex: 1 1 auto; }
        .topbar-actions { display: inline-flex; align-items: center; gap: var(--space-sm); flex-wrap: wrap; }
        .brand {
            font-weight: 600;
            letter-spacing: 0.2px;
            color: var(--fg);
            font-size: 15px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .brand:hover {
            opacity: 0.8;
        }
        .mode-indicator {
            font-size: 11px;
            font-weight: 400;
            color: var(--muted);
            letter-spacing: 0;
            margin-left: 8px;
        }
        .topbar-right-group {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }
        .waypoint-toggle {
            border: 1px solid var(--line);
            background: transparent;
            color: var(--fg);
            padding: 6px 12px;
            border-radius: var(--radius);
            font-size: 13px;
            transition: background .15s ease,border-color .15s ease,color .15s ease;
        }
        .waypoint-toggle.on {
            background: var(--brand);
            color: #fff;
            border-color: var(--brand);
        }
        /* Segmented button styles - commented out for Standard-only version
        .segmented {
            display: inline-flex;
            border: 1px solid var(--line);
            border-radius: var(--radius);
            overflow: hidden;
            background: var(--bg);
        }
        .segment {
            padding: 6px 12px;
            background: var(--bg);
            cursor: default;
            border: none;
            font-weight: 500;
            color: var(--fg);
            font-size: 13px;
        }
        .segment.active { background: var(--brand); color: #ffffff; }
        .divider { width: 1px; background: var(--line); }
        */
        .status { font-size: 12px; color: var(--muted); white-space: nowrap; }
        .btn-primary-modern {
            background: var(--brand);
            color: #fff;
            border: 1px solid var(--brand);
            padding: 6px 12px;
            border-radius: var(--radius);
            transition: background .15s ease,border-color .15s ease,box-shadow .15s ease;
            font-size: 12.5px;
        }
        .btn-primary-modern.loading {
            cursor: wait;
            opacity: 0.75;
        }
        .btn-primary-modern:hover{ background: var(--brand-600); border-color: var(--brand-600); }
        .btn-ghost {
            background: #0b0b0f;
            border: 1px solid #0b0b0f;
            color: #fff;
            padding: 6px 12px;
            border-radius: var(--radius);
            transition: background .15s ease,border-color .15s ease,opacity .15s ease;
            font-size: 12.5px;
        }
        .btn-ghost:hover{ opacity: 0.9; }
        .toggle {
            border: solid 1px #a2a2a2;
        }
        /* Parameter panel */
        #param-panel {
            border-top: 1px solid var(--soft);
            padding: 12px 24px 16px 24px;
            background: var(--soft2);
            max-height: 60vh;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch;
            transition: opacity 0.15s ease;
            opacity: 1;
        }
        #param-panel.collapsed {
            display: none;
            opacity: 0;
        }
        .param-grid {
            display: flex;
            justify-content: space-between;
            gap: 60px;
            width: 100%;
        }
        .param-column {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            min-width: 0;
            flex: 0 1 auto;
        }
        .param-field {
            display: grid;
            grid-template-columns: 165px 1fr;
            align-items: center;
            column-gap: 10px;
            row-gap: 4px;
            min-width: 0;
            font-size: 13px;
            color: var(--fg);
        }
        .param-field .field-label {
            font-weight: 600;
            white-space: nowrap;
            text-align: left;
        }
        .field-label-empty { visibility: hidden; }
        .param-field .field-inputs {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            justify-self: start;
            width: max-content;
            max-width: 100%;
            flex-wrap: wrap;
        }
        .param-field-status {
            font-weight: 600;
            gap: 6px;
        }
        .param-field-status .field-label {
            justify-self: start;
        }
        .param-field-status span:last-child { font-weight: 600; }
        .field-input {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 5px 8px;
            background: var(--bg);
            color: var(--fg);
        }
        .field-input:focus { outline: 2px solid var(--brand-600); outline-offset: 1px; }
        .field-sep {
            color: var(--muted);
            font-weight: 500;
        }
        .unit {
            font-size: 12px;
            color: var(--muted);
            white-space: nowrap;
        }
        .field-input-xs { width: 48px; }
        .field-input-sm { width: 64px; }
        .field-input-md { width: 88px; }
        .field-input-lg { width: 120px; }
        .param-extra {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 40px;
            width: 100%;
            margin-top: var(--space-sm);
        }
        .param-field.placeholder {
            visibility: hidden;
        }
        .spinner {
            width: 14px;
            height: 14px;
            border: 2px solid var(--line);
            border-top-color: var(--brand);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            display: none;
            margin: 0 6px;
        }
        .spinner.active { display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }
        @media (max-width: 900px) {
            .topbar-firstline {
                justify-content: space-between;
            }
            .topbar-actions { width: 100%; justify-content: flex-start; }
            .status { white-space: normal; }
        }
        @media (max-width: 768px) {
            .topbar { padding-left: 12px; padding-right: 12px; }
            #param-panel { padding-left: 12px; padding-right: 12px; }
            .topbar-firstline { gap: var(--space-sm); }
            .topbar-right-group { width: 100%; flex-direction: column; }
            .param-grid { flex-direction: column; }
            .param-field {
                grid-template-columns: 1fr;
                row-gap: 6px;
            }
            .param-field .field-label {
                justify-self: start;
            }
            .param-field .field-inputs {
                width: 100%;
                justify-self: stretch;
                flex-wrap: wrap;
            }
            .topbar-actions { flex-direction: column; align-items: stretch; gap: var(--space-xs); }
            .btn-primary-modern, .btn-ghost { width: 100%; display: inline-flex; justify-content: center; }
            .param-extra { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<nav id="info" class="navbar navbar-light bg-light" style="position:fixed; top:0; left:0; right:0; z-index:1000;">
    <div class="topbar">
        <div class="topbar-firstline">
            <a href="https://www.stanfordssi.org/" target="_blank" rel="noopener noreferrer" class="brand">HABSIM</a>
            <span class="mode-indicator">Standard</span>
            <!-- Segmented mode selector - commented out for Standard-only version
            <div class="segmented" role="group" aria-label="Mode">
                <button class="segment active" data-mode="standardbln">Standard</button>
                <div class="divider"></div>
                <button class="segment" data-mode="zpbbln">ZPB</button>
                <div class="divider"></div>
                <button class="segment" data-mode="floatbln">Float</button>
            </div>
            -->
            <div class="topbar-spacer"></div>
            <div class="topbar-right-group">
                <button id="waypoint-toggle" type="button" class="waypoint-toggle on">Waypoints</button>
                <div class="topbar-actions">
                    <button id="simulate-btn" class="btn-primary-modern" type="button" onclick="simulate()">Simulate</button>
                    <div id="sim-spinner" class="spinner" aria-hidden="true"></div>
                    <div class="status" role="status">Model run: <span id="run">Unavailable</span> • Server: <span id="status">Unavailable</span></div>
                    <button id="collapse-toggle" class="btn-ghost" title="Show/Hide parameters">Toggle panel</button>
                </div>
            </div>
        </div>
    </div>
    <div id="param-panel">
        <div class="param-grid">
            <div class="param-column">
                <div class="param-field param-field-date">
                    <span class="field-label">Date</span>
                    <div class="field-inputs">
                        <input id="mo" class="field-input field-input-xs" type="text" name="mo">
                        <span class="field-sep">/</span>
                        <input id="day" class="field-input field-input-xs" type="text" name="day">
                        <span class="field-sep">/</span>
                        <input id="yr" class="field-input field-input-sm" type="text" name="yr">
                    </div>
                </div>
                <div class="param-field param-field-time">
                    <span class="field-label">Time (UTC)</span>
                    <div class="field-inputs">
                        <input id="hr" class="field-input field-input-xs" type="text" name="hr">
                        <span class="field-sep">:</span>
                        <input id="mn" class="field-input field-input-xs" type="text" name="mn">
                    </div>
                </div>
                <!-- ZPB mode field - commented out
                <div class="param-field" id="group-eqtime" style="display:none;">
                    <span class="field-label">Time at Equilibrium</span>
                    <div class="field-inputs">
                        <input id="eqtime" class="field-input field-input-md" type="text" name="eqtime">
                        <span class="unit">h</span>
                    </div>
                </div>
                -->
                <!-- Float mode field - commented out
                <div class="param-field" id="group-dur" style="display:none;">
                    <span class="field-label">Simulate for</span>
                    <div class="field-inputs">
                        <input id="dur" class="field-input field-input-md" type="text" name="dur">
                        <span class="unit">h</span>
                    </div>
                </div>
                -->
            </div>
            <div class="param-column">
                <div class="param-field">
                    <span class="field-label">Lat</span>
                    <div class="field-inputs">
                        <input id="lat" class="field-input field-input-md" type="text" name="lat">
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Lon</span>
                    <div class="field-inputs">
                        <input id="lon" class="field-input field-input-md" type="text" name="lon">
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Launch altitude</span>
                    <div class="field-inputs">
                        <input id="alt" class="field-input field-input-md" type="text" name="alt">
                        <span class="unit">m</span>
                    </div>
                </div>
            </div>
            <div class="param-column">
                <div class="param-field">
                    <span class="field-label">Ascent rate</span>
                    <div class="field-inputs">
                        <input id="asc" class="field-input field-input-md" type="text" name="asc">
                        <span class="unit">m/s</span>
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Burst altitude</span>
                    <div class="field-inputs">
                        <input id="equil" class="field-input field-input-md" type="text" name="equil">
                        <span class="unit">m</span>
                    </div>
                </div>
                <div class="param-field">
                    <span class="field-label">Descent rate</span>
                    <div class="field-inputs">
                        <input id="desc" class="field-input field-input-md" type="text" name="desc">
                        <span class="unit">m/s</span>
                    </div>
                </div>
            </div>
            <!-- Float mode column - commented out
            <div class="param-column">
                <div class="param-field" id="group-coeff" style="display:none;">
                    <span class="field-label">Floating Coefficient</span>
                    <div class="field-inputs">
                        <input id="coeff" class="field-input field-input-md" type="text" name="coeff">
                    </div>
                </div>
                <div class="param-field" id="group-step" style="display:none;">
                    <span class="field-label">Step Size</span>
                    <div class="field-inputs">
                        <input id="step" class="field-input field-input-md" type="text" name="step">
                        <span class="unit">s</span>
                    </div>
                </div>
                <div class="param-field placeholder" aria-hidden="true"></div>
            </div>
            -->
        </div>
        <div class="visually-hidden" aria-hidden="true">
            <input type="radio" name="optradio" class="radiobtn" value="standardbln" checked>
            <!-- <input type="radio" name="optradio" class="radiobtn" value="zpbbln">
            <input type="radio" name="optradio" class="radiobtn" value="floatbln"> -->
        </div>
    </div>
</nav>
<main id="main-container">
    <div id="map"></div>
</main>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC62-iKLT_54_N0cPnbQlrzIsEKQxiAJgA&v=quarterly"></script>
<script type="text/javascript" src = "style.js"></script>
<script type="text/javascript" src = "paths.js"></script>
<script type="text/javascript" src = "util.js"></script>
<script>
    function adjustLayout() {
        const nav = document.getElementById('info');
        const main = document.getElementById('main-container');
        if (!nav || !main) return;
        const navHeight = nav.offsetHeight;
        document.body.style.paddingTop = navHeight + 'px';
        main.style.height = `calc(100vh - ${navHeight}px)`;
    }
    window.addEventListener('load', adjustLayout);
    window.addEventListener('resize', adjustLayout);
        // topbar segmented buttons - disabled since only Standard mode is available
        window.addEventListener('DOMContentLoaded', function(){
            // Mode switching disabled - only Standard mode available
            // const segs = document.querySelectorAll('.segment');
            // segs.forEach(btn => {
            //     btn.addEventListener('click', () => {
            //         segs.forEach(b=>b.classList.remove('active'));
            //         btn.classList.add('active');
            //         const val = btn.getAttribute('data-mode');
            //         const radio = document.querySelector(`input[name="optradio"][value="${val}"]`);
            //         if (radio) { radio.checked = true; radio.dispatchEvent(new Event('change')); }
            //     });
            // });
            const collapseBtn = document.getElementById('collapse-toggle');
            const panel = document.getElementById('param-panel');
            collapseBtn.addEventListener('click', () => {
                if (panel.classList.contains('collapsed')) {
                    // Fade in: remove display:none first, then fade in
                    panel.classList.remove('collapsed');
                    panel.style.opacity = '0';
                    requestAnimationFrame(() => {
                        panel.style.opacity = '1';
                    });
                } else {
                    // Fade out: fade first, then set display:none
                    panel.style.opacity = '0';
                    setTimeout(() => {
                        panel.classList.add('collapsed');
                    }, 150);
                }
                setTimeout(adjustLayout, 150);
            });
        });
</script>
</body>
</html>
